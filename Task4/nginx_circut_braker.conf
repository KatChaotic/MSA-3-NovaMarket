# Таймаут ответа — 3 секунды.
# Если 5 подряд запросов завершаются ошибкой, отключаем попытки на 30 секунд (отдаём fallback-ответ).
# Если после паузы сервис снова работает, восстанавливаем вызовы.
http {
    upstream logistics_backend {
        server logistics.company.com max_fails=5 fail_timeout=30s;
    }

    server {
        listen 8080;

        location /logistics/ {
            proxy_pass http://logistics_backend;

            proxy_next_upstream error timeout http_500 http_502 http_503 http_504;
            proxy_connect_timeout 3s;
            proxy_read_timeout 3s;
        }
    }
} 